---
author: denalon
title: "2020 06 07 Hugo持续集成"
linkTitle: "2020 06 07 Hugo持续集成"
date: 2020-06-07T18:20:21+08:00
draft: false
url: /web/deploy/2020/202006071.html
description: > 
                2020 06 07 Hugo持续集成
---

### 通过github actions 发布

使用代码：

```
name: Deploy to GitHub Pages
on:
  push:	
    branches:	
      - master

jobs:
  deploy:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest    
    steps:
    - name: 1. git checkout...
      uses: actions/checkout@v1
      
    - name: 2. setup nodejs...
      uses: actions/setup-node@v1

    - name: 3 run postcss
      run: |
        npm install -D --save autoprefixer
        npm install -D --save postcss-cli
        
    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2.2.2
      with:
          hugo-version: 'latest'
          extended: true
      
    - name: Build
      run: hugo --minify


    - name: deploy
      uses: s0/git-publish-subdir-action@master
      env:
        REPO: git@github.com:denalon/anna.git
        BRANCH: master
        FOLDER: public
        SSH_PRIVATE_KEY: ${{ secrets.PUSH }}

```

### 期间出现的问题

由于本身自己对配置ci/cd不熟，出现代码错误。包括yaml语法和对acitons的命令。

出现以下情况：

![](https://base.oribos.city/images/20200607.png)


然后多次修改以后，发现最后一步daploy出现错误？发现自己上传错git仓库了，本来时由z仓库push到anna仓库，结果一直都是在anna仓库操作，等于自己push自己。。。


### 心有余悸

由于对自己配置文件的不熟，现在还不敢正式往自己的denalon.github.io仓库推送。这片文章还是通过原始的在本地生成后发布的方法。

所以，虽然部署在github上的资源已经完全使用自动部署的代码，但位于coding上的关键资料仓库并没有同步使用，让保持之前代码以备用。发布到b.hbn.pub的页面也没有第一时间更新。终于理解软件开发过程中，对关键资源和新资源上线的管理有多慎重。

由于对初步尝试自动部署，重新调整对旧资源管理，包括命名规范，存放位置，cdn和备份做调整。而完成这些调整需要一个较长时间，导致旧资源暂无法访问。


### 理解持续集成

当一个应用开发时，需要10个模块和功能。

旧的开发模式时，用一段时间开发出这个10个模块和连接，测试，发布。开发，测试都需要大量时间，又时候复杂的应用对资源的处理和使用存在冲突就需要逐一解决。


新的模式，快速构造出应用结构。快速测试，发布。在线对功能进行细微调整，并测试，发布，指定相应节点。当出现错误时，直接返回上一个节点，重新调整，测试，发布。不断迭代更新。因为上一个节点时已经测试和实际运行的，并不会造成多大影响。可以逐步迭代更新。

