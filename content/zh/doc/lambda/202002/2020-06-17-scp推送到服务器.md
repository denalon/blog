---
author: denalon
title: "2020061702"
date: 2020-06-17T10:18:59+08:00
url: /web/note/2020/2020061702.html
draft: false
description: "推送到服务器"
---

### 在coding构建计划里，将文件推送到服务里。

```
def remoteConfig = [:]
remoteConfig.name = "my-remote-server"
remoteConfig.host = "${env.REMOTE_HOST}"
remoteConfig.allowAnyHosts = true
// 使用 SCP 作为文件传输
remoteConfig.fileTransfer = "scp"

pipeline {
  agent any
  stages {
    stage('检出') {
      steps {
        checkout([
          $class: 'GitSCM',
          branches: [[name: env.GIT_BUILD_REF]],
          userRemoteConfigs: [[
            url: env.GIT_REPO_URL,
            credentialsId: env.CREDENTIALS_ID
          ]]])
        }
      }
  stage('更新子模块') {
    steps {
      dir('./content/zh') {
        sh 'rm  -rf ./note'
        sh 'git clone https://${B_USER}:${B_TOKEN}@${NOTE_GIT}'
      }

      dir('./content/zh') {
        sh 'rm  -rf ./lambda'
        sh 'git clone https://${B_USER}:${B_TOKEN}@${LAMBDA_GIT}'
      }

        }
      }
      
    }
  }

node {
  withCredentials([sshUserPrivateKey(
    credentialsId: "${env.REMOTE_CRED}",
    keyFileVariable: "privateKeyFilePath"
  )]) {

    // SSH 登陆用户名
    remoteConfig.user = "${env.REMOTE_USER_NAME}"
    // SSH 私钥文件地址
    remoteConfig.identityFile = privateKeyFilePath

    stage("通过 SSH 执行命令") {
              sh 'ls -a'

      // 将本地的文件复制到远端
      sshPut(
        remote: remoteConfig,
        // 本地文件或文件夹
        from: './',
        // 远端文件或文件夹
        into: '/denalon/push/'
      )

    }
  }
}
```

