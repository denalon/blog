---
title: "2020 05 18 记录"
date: 2020-05-18T16:35:48+08:00
draft: false
url: /web/blog/2020/note/2020051801.html
---

```
upstream xxx.xxx.xxx{ 
#XXX.COM更改为需要负载均衡的域名
#upstream参数配置主副服务器
      ip_hash; #IP哈希值算法
      server  xxx.xxx.xxx:80; #服务器1，IP替换为自己的服务器真实IP
    
}

```


### 服务器被攻击

为了测试负载均衡的效果，将网址分享出去，结果服务器很快就收到大量攻击。之前还没有真正接触到服务器攻击，后续服务器的设置出现如下变动：

取消所有主机记录在dns上的A解析

### 服务器被攻击带来的心理阴影

不再在公共渠道公布自己的ip地址，部署在服务器上的网站都需要连接cdn，dns不再直接解析a记录

#### 对博客页面增加服务

经过多次测试，现在将博客文件增加serverless 和cloudflare workers。配置文件添加到博客项目目录里，每次发布进行serverless  wrangler publish 和git push操作


#### 测试页面cdn

对网站内容，增加多处cdn

###  b.hbn.pub是主要文章发布页面

b.hbn.pub作为主要文章发布页面，由以下几个部分组成


g. 部署在github pages和coding pages上，这些内容由cdn解析成g.hbn.pub网页


t. 配置文件和生成的public文件，部署在云服务器上。这些页面内容解析到t.hbn.pub页面


然后再以g.hbn.pub和t.hbn.pub作为源站配置cdn为b.hbn.pub加速。


g.hbn.pub 和t.hbn.pub 页面即添加有g. 或t. dns解析，由有b.解析。也就是说，这些内容均可以直接通过b.hbn.pub访问。

即  b=(g/t/b)

<!--more-->

### info 作为单页内容

info页面适合发布一些，只显示基本文字，没有列表，目录等额外内容的单独页面。用来显示临时，功能有限的文档。作为函数计算的一部分数据，甚至不需要保存在服务器里。

info页面需要显示的img，样式等内容均引用url地址，不使用本地资源。包括字体，css，js，图片等等。均引用完整的url地址。

### 中转页面

使用cloudflare的workers，设置一个域名，专门用来中转链接，函数运行等等不需要服务器。